#指针
***
指针的使用是现代编程中最容易出错的领域之一，以至于像Java、C#和VB，这些现代语言都没有提供指针数据类型，对指针的运用具有其固有的复杂性，正确使用指针要求你对所用编译器的内存管理机制有很好的理解。很多常见的安全问题，特别是缓冲区溢出，其产生都可以追溯到错误地运用指针上去
即使你的语言不要求你使用指针，其很好的理解指针也会有助于你理解你的编程语言是如何工作的。

我们将内存中字节的编号称为地址（Address）或指针（Pointer）。地址从 0 开始依次增加，对于 32 位环境，程序能够使用的内存为 4GB，最小的地址为 0，最大的地址为 0XFFFFFFFF。
下面的代码演示了如何输出一个地址：
```c
#include <stdio.h>
int main(){
    int a = 100;
    char str[20] = "c.biancheng.net";
    printf("%#X, %#X\n", &a, str);
    return 0;
}
```
运行结果：
0X28FF3C, 0X28FF10

##一切都是地址
C语言用变量来存储数据，用函数来定义一段可以重复使用的代码，它们最终都要放到内存中才能供 CPU 使用。

数据和代码都以二进制的形式存储在内存中，计算机无法从格式上区分某块内存到底存储的是数据还是代码。当程序被加载到内存后，操作系统会给不同的内存块指定不同的权限，拥有读取和执行权限的内存块就是代码，而拥有读取和写入权限（也可能只有读取权限）的内存块就是数据。

CPU 只能通过地址来取得内存中的代码和数据，程序在执行过程中会告知 CPU 要执行的代码以及要读写的数据的地址。如果程序不小心出错，或者开发者有意为之，在 CPU 要写入数据时给它一个代码区域的地址，就会发生内存访问错误。这种内存访问错误会被硬件和操作系统拦截，强制程序崩溃，程序员没有挽救的机会。

CPU 访问内存时需要的是地址，而不是变量名和函数名！变量名和函数名只是地址的一种助记符，当源文件被编译和链接成可执行程序后，它们都会被替换成地址。编译和链接过程的一项重要任务就是找到这些名称所对应的地址。

##使用指针的一般技巧
1.把指针操作i安置在子程序或者类里面
2.同时声明和定义指针
3.在于指针分配相同的作用域中删除指针
4.在使用指针之前检查指针
5.先检查指针所引用的变量在使用它
6.用狗牌字段来检测损毁内容
7.增加明显的冗余
8.用额外的指针变量来提高代码清晰度
9.简化复杂的指针表达式

##指针的使用
假设 a 的地址是 0X1000，p 指向 a 后，p 本身的值也会变为 0X1000，*p 表示获取地址 0X1000 上的数据，也即变量 a 的值。从运行结果看，*p 和 a 是等价的。

上节我们说过，CPU 读写数据必须要知道数据在内存中的地址，普通变量和指针变量都是地址的助记符，虽然通过 *p 和 a 获取到的数据一样，但它们的运行过程稍有不同：a 只需要一次运算就能够取得数据，而 *p 要经过两次运算，多了一层“间接”。

假设变量 a、p 的地址分别为 0X1000、0XF0A0，它们的指向关系如下图所示：
![](http://c.biancheng.net/uploads/allimg/190114/1IG3MJ-2.jpg)
程序被编译和链接后，a、p 被替换成相应的地址。使用 *p 的话，要先通过地址 0XF0A0 取得变量 p 本身的值，这个值是变量 a 的地址，然后再通过这个值取得变量 a 的数据，前后共有两次运算；而使用 a 的话，可以通过地址 0X1000 直接取得它的数据，只需要一步运算。
实例代码
```c
#include <stdio.h>
int main(){
    int a = 15;
    int *p = &a;
    printf("%d, %d\n", a, *p);  //两种方式都可以输出a的值
    return 0;
}
```
##关于 * 和 & 的谜题
假设有一个 int 类型的变量 a，pa 是指向它的指针，那么*&a和&*pa分别是什么意思呢？

*&a可以理解为*(&a)，&a表示取变量 a 的地址（等价于 pa），*(&a)表示取这个地址上的数据（等价于 *pa），绕来绕去，又回到了原点，*&a仍然等价于 a。

&*pa可以理解为&(*pa)，*pa表示取得 pa 指向的数据（等价于 a），&(*pa)表示数据的地址（等价于 &a），所以&*pa等价于 pa。

##对星号*的总结
在我们目前所学到的语法中，星号*主要有三种用途：
* 表示乘法，例如int a = 3, b = 5, c;  c = a * b;，这是最容易理解的。
* 表示定义一个指针变量，以和普通变量区分开，例如int a = 100;  int *p = &a;。
* 表示获取指针指向的数据，是一种间接操作，例如int a, b, *p = &a;  *p = 100;  b = *p;。
